import streamlit as st
import json
import os

PROFILE_FILE = "profiles.json"

def load_profiles():
    if os.path.exists(PROFILE_FILE):
        with open(PROFILE_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    return {}

def save_profiles(profiles):
    with open(PROFILE_FILE, "w", encoding="utf-8") as f:
        json.dump(profiles, f, ensure_ascii=False, indent=4)

def show_student():
    st.title("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ üìö")
    
    profiles = load_profiles()
    if not profiles:
        st.warning("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå")
        return
    
    # ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
    student_ids = list(profiles.keys())
    selected_id = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤", student_ids)
    
    if selected_id:
        profile = profiles[selected_id]
        
        # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        st.write("**‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô**")
        st.write(f"**‡∏ä‡∏∑‡πà‡∏≠:** {profile.get('name','')}")
        st.write(f"**‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤:** {profile.get('school','')}")
        st.write(f"**‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à:** {profile.get('favorite_subject','‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏')}")
        st.write(f"**‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:** {profile.get('phone','')}")
        st.write(f"**Email:** {profile.get('email','')}")
        st.write(f"**‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:** {profile.get('address','')}")
        
        st.write("---")
        st.subheader("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤")
        new_name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà", value=profile.get('name',''))
        new_school = st.text_input("‡∏™‡∏ñ‡∏≤‡∏ô‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÉ‡∏´‡∏°‡πà", value=profile.get('school',''))
        new_subject = st.text_input("‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏ô‡πÉ‡∏à‡πÉ‡∏´‡∏°‡πà", value=profile.get('favorite_subject',''))
        new_phone = st.text_input("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡∏°‡πà", value=profile.get('phone',''))
        new_email = st.text_input("Email ‡πÉ‡∏´‡∏°‡πà", value=profile.get('email',''))
        new_address = st.text_area("‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏´‡∏°‡πà", value=profile.get('address',''))
        
        if st.button("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"):
            profiles[selected_id] = {
                "name": new_name,
                "school": new_school,
                "favorite_subject": new_subject,
                "phone": new_phone,
                "email": new_email,
                "address": new_address
            }
            save_profiles(profiles)
            st.session_state['selected_student'] = profiles[selected_id]  # ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï session
            st.success("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ üéâ")
        
        # ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô session state
        st.session_state['selected_student'] = profiles[selected_id]
